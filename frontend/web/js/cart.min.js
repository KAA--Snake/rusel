var currenciesData;$(document).ready(function(){"/order/done/"==document.location.pathname&&(cookie.deleteCookie("cart"),console.log(document.cookie)),getCityList(),cartCheck(),orderLinkCountUpdate(),$(".contact_block .contact_item.order").click(function(){window.location.href="/cart/"}),$("#org").suggestions({token:"240612ffd28e9888533a15c054c025ea2968155f",type:"PARTY",count:10,onSelect:showSuggestion}),$(".js-city-select").on("change",function(){getDeliveryTime(this.value),$(".js-delivery_city_index").val(this.value),$(".js-delivery_city_name").val($(this).find("option[value=\""+this.value+"\"]").text())}),$(".js-delivery-radio").click(function(){console.log($(this)),this.checked&&$(this).hasClass("js-delivery-full")?($(".js-delivery-input").show().removeClass("hidden"),$(".address_subheader").show().removeClass("hidden"),$("input#tel").attr("data-validation","required"),$("#delivery_city").attr("data-validation","required"),$("#delivery_address").attr("data-validation","required"),-1==$(".delivery_time_text").text().indexOf(" + 1-2 \u0440\u0430\u0431.\u0434\u043D. \u0434\u043E \u0434\u0432\u0435\u0440\u0438.")&&0<$(".delivery_time_text").text().length&&$(".delivery_time_text").append(" + 1-2 \u0440\u0430\u0431.\u0434\u043D. \u0434\u043E \u0434\u0432\u0435\u0440\u0438.")):this.checked&&$(this).hasClass("js-delivery-half")?($(".js-delivery-input.js-delivery-full").hide(),$(".js-delivery-input.js-delivery-full input").attr("data-validation",""),$(".js-delivery-input.js-delivery-half").show().removeClass("hidden"),$("input#tel").attr("data-validation","required"),$(".js-delivery-input.js-delivery-half input").attr("data-validation","required"),$("#delivery_city").attr("data-validation","required"),$("#delivery_address").attr("data-validation",""),$(".address_subheader").show().removeClass("hidden"),-1!==$(".delivery_time_text").text().indexOf(" + 1-2 \u0440\u0430\u0431.\u0434\u043D. \u0434\u043E \u0434\u0432\u0435\u0440\u0438.")&&0<$(".delivery_time_text").text().length&&$(".delivery_time_text").text($(".delivery_time_text").text().slice(0,$(".delivery_time_text").text().indexOf(" + 1-2 \u0440\u0430\u0431.\u0434\u043D. \u0434\u043E \u0434\u0432\u0435\u0440\u0438.")))):($(".js-delivery-input").hide(),$("input#tel").attr("data-validation",""),$(".js-delivery-input input").attr("data-validation",""),$("#delivery_city").attr("data-validation",""),$(".address_subheader").hide(),$(".delivery_time_text").text(""))}),$(".js-cancel-order").click(function(){var a=$(this).closest(".js-order_data"),b=$(this).closest(".js-product_card"),c={productCount:JSON.parse(decodeURIComponent(a.data().productCount)),productMarketingPrice:JSON.parse(decodeURIComponent(a.data().productMarketingPrice)),productMin_zakaz:JSON.parse(decodeURIComponent(a.data().productMin_zakaz)),productNorma_upakovki:JSON.parse(decodeURIComponent(a.data().productNorma_upakovki)),productPartnerCount:JSON.parse(decodeURIComponent(a.data().productPartnerCount)),productPrices:JSON.parse(decodeURIComponent(a.data().productPrices)),product_id:JSON.parse(decodeURIComponent(a.data().product_id)),storage_id:a.data().productStorageId},d=a.data("product_id"),e=a.find(".js-order_count").val(),f=a.find(".order_block"),g=a.find(".ordered_block"),h=g.find(".ordered_count .bold"),i=g.find(".ordered_price .bold"),j=$(this);"/cart/"==document.location.pathname?($(this).closest(".ordered_block").append("<span class=\"count_tooltip js-remove-from-cart\"><span class=\"order_buttons_block\"><span class=\"order_button decline_delete_pos\">\u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E</span> <span class=\"order_button approve_delete_pos\">\u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0438\u0437 \u0437\u0430\u043F\u0440\u043E\u0441\u0430</span></span> <span class=\"corner\"></span></span>"),$(document.body).prepend("<div class=\"tooltip_layer\"></div>"),$(".tooltip_layer").click(function(){j.closest(".ordered_block").find(".js-remove-from-cart").remove(),$(this).remove()}),$(".approve_delete_pos").click(function(){$(".tooltip_layer").remove(),cartPositionDelete(d,e,c.storage_id||null),a.closest(".js-store-row").remove(),console.log(b.find(".js-store-row")),b.find(".js-store-row").length||b.remove(),console.log(b),console.log(b.length),$(".js-product_card").length||$(".product_cards_block._order").html("<h1>\u0424\u043E\u0440\u043C\u0430 \u0437\u0430\u043F\u0440\u043E\u0441\u0430</h1> <div class=\"_order_section _selected_products\"> <h2>\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u043D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u044F</h2> <div class=\"empty_order\">\u0412\u044B \u0435\u0449\u0435 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u043B\u0438 \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u044F \u0432 \u0437\u0430\u043F\u0440\u043E\u0441</div> </div>")}),$(".decline_delete_pos").click(function(){$(".tooltip_layer").remove(),$(this).closest(".count_tooltip").remove(),cartPositionDelete(d,e,c.storage_id||null),f.show().removeClass("hidden"),g.hide().addClass("hidden"),a.find(".js-order_count").val("")})):(cartPositionDelete(d,e,c.storage_id||null),f.show().removeClass("hidden"),g.hide().addClass("hidden"),a.find(".js-order_count").val(""))}),$(".js-add_to_cart").click(function(){var a=$(this).closest(".js-order_data"),b={productCount:null==JSON.parse(decodeURIComponent(a.data().productCount))?"0":JSON.parse(decodeURIComponent(a.data().productCount)),productMarketingPrice:JSON.parse(decodeURIComponent(a.data().productMarketingPrice)),productMarketingPriceCurrency:JSON.parse(decodeURIComponent(a.data().productMarketingPriceCurrency)),productMin_zakaz:JSON.parse(decodeURIComponent(a.data().productMin_zakaz)),productNorma_upakovki:JSON.parse(decodeURIComponent(a.data().productNorma_upakovki)),productPartnerCount:null==JSON.parse(decodeURIComponent(a.data().productPartnerCount))?"0":JSON.parse(decodeURIComponent(a.data().productPartnerCount)),productPrices:null==JSON.parse(decodeURIComponent(a.data().productPrices))?{price_not_available:!0}:JSON.parse(decodeURIComponent(a.data().productPrices)),product_id:a.data().product_id,storage_id:a.data().productStorageId},c=a.data("product_id"),d=parseInt(a.find(".js-order_count").val()),e=a.find(".order_block"),f=a.find(".ordered_block"),g=f.find(".ordered_count .bold"),h=f.find(".ordered_price .bold"),i=0,j=cookie.getCookie("cart")||"";if(isNaN(d)||0==d.length||0>=d)return!1;if(!b.productPrices.price_not_available){if(b.productPrices.price_range)if(null!==b.productMarketingPrice){var k=+b.productMarketingPriceCurrency;i=+b.productMarketingPrice*getRateOfExchange(k)}else if(b.productPrices.price_range.length){for(var l,m=0;m<b.productPrices.price_range.length;m++)if(l=m+1==b.productPrices.price_range.length?b.productPrices.price_range.length-1:m+1,parseInt(b.productPrices.price_range[m].range)>d||parseInt(b.productPrices.price_range[m].range)<=d&&parseInt(b.productPrices.price_range[l].range)>d){i=(+b.productPrices.price_range[m].value*getRateOfExchange(b.productPrices.price_range[m].currency)).toFixed(2);break}else i=(+b.productPrices.price_range[l].value*getRateOfExchange(b.productPrices.price_range[l].currency)).toFixed(2),console.log("rn"),console.log(+b.productPrices.price_range[l].value+"*"+getRateOfExchange(b.productPrices.price_range[l].currency)+"="+i),console.log("rn");}else i=(+b.productPrices.price_range.value*getRateOfExchange(b.productPrices.price_range.currency)).toFixed(2);}else if(null!==b.productMarketingPrice){var k=+b.productMarketingPriceCurrency;i=+b.productMarketingPrice*getRateOfExchange(k)}-1==j.indexOf(b.product_id)&&(e.show().removeClass("hidden"),f.hide().addClass("hidden")),d<parseInt(b.productMin_zakaz)&&+b.productCount!=+d?(e.append("<span class=\"count_tooltip\" style=\"top: -94px;\">\u0417\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u043E\u043B\u0436\u043D\u043E \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043E\u0432\u0430\u0442\u044C \u043C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0439 \u043F\u0430\u0440\u0442\u0438\u0438, \u043B\u0438\u0431\u043E \u0432\u0441\u0435\u043C\u0443 \u043E\u0441\u0442\u0430\u0442\u043A\u0443 \u043D\u0430 \u0441\u043A\u043B\u0430\u0434\u0435 (\u043F\u0440\u0438 \u043D\u0430\u043B\u0438\u0447\u0438\u0438).<span class=\"corner\"></span></span>"),setTimeout(function(){e.find(".count_tooltip").fadeOut(function(){$(this).remove()})},5e3)):d%parseInt(b.productNorma_upakovki)&&+b.productCount!=+d?(e.append("<span class=\"count_tooltip\" style=\"top: -94px;\">\u0417\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u043E\u043B\u0436\u043D\u043E \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043E\u0432\u0430\u0442\u044C \u0443\u043A\u0430\u0437\u0430\u043D\u043D\u043E\u0439 \u043A\u0440\u0430\u0442\u043D\u043E\u0441\u0442\u0438, \u043B\u0438\u0431\u043E \u0432\u0441\u0435\u043C\u0443 \u043E\u0441\u0442\u0430\u0442\u043A\u0443 \u043D\u0430 \u0441\u043A\u043B\u0430\u0434\u0435 (\u043F\u0440\u0438 \u043D\u0430\u043B\u0438\u0447\u0438\u0438).<span class=\"corner\"></span></span>"),setTimeout(function(){e.find(".count_tooltip").fadeOut(function(){$(this).remove()})},5e3)):(e.find(".count_tooltip").fadeOut(function(){$(this).remove()}),e.hide().addClass("hidden"),f.show().removeClass("hidden"),cartUpdate(c,d,b.storage_id||null),g.html(d+" \u0448\u0442"),0<d*i?h.html((d*i).toFixed(2)+" \u20BD"):h.html("\u043F\u043E \u0437\u0430\u043F\u0440\u043E\u0441\u0443"),console.log("(productCount * orderPrice)"),console.log(d+"*"+i+"="+d*i),a.find(".js-order_count").val(""),b.productPrices.price_not_available&&(null==b.productMarketingPrice||0==b.productMarketingPrice)&&0==h.find(".count_tooltip").length&&(h.html("\u043F\u043E \u0437\u0430\u043F\u0440\u043E\u0441\u0443"),h.addClass("tooltip_sum"),h.append("<span class=\"count_tooltip\">\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u0431\u0443\u0434\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0430 \u043F\u043E\u0441\u043B\u0435 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438 \u0437\u0430\u043F\u0440\u043E\u0441\u0430.<span class=\"corner\"></span></span>"))),console.log(b)}),$(".js-order_count").inputmask({mask:"[9]",repeat:16,greedy:!1}),$.validate({form:"#order_request_form",lang:"ru"})});function getRateOfExchange(a){var b=0;return!!$("body").data("currencies")&&$("body").data("currencies")[a]?b=+$("body").data("currencies")[a]:$.ajax({url:"/ajax/get-currencies/",async:!1,success:function(c){$("body").data("currencies",c),c[a]&&(b=+c[a])}}),console.log("currency : "+b),b}function cartCheck(){var a=$(".js-product_card").length,b=cookie.getCookie("cart")?cookie.getCookie("cart"):"";if(0<b.length&&0<a)for(var c,d=b.length?b.split("&"):[],e=0;e<d.length;e++)c=d[e].split("|"),$(".js-order_data").each(function(){if(console.log($(this).data().product_id+"=="+c[0]+"|"+$(this).data().productStorageId+"=="+c[2]),console.log($(this).data().productStorageId),console.log(typeof c[2]),$(this).data().product_id==c[0]&&$(this).data().productStorageId+""==c[2]){var a=$(this),b={productCount:JSON.parse(decodeURIComponent(a.data().productCount)),productMarketingPrice:JSON.parse(decodeURIComponent(a.data().productMarketingPrice)),productMarketingPriceCurrency:JSON.parse(decodeURIComponent(a.data().productMarketingPriceCurrency)),productMin_zakaz:JSON.parse(decodeURIComponent(a.data().productMin_zakaz)),productNorma_upakovki:JSON.parse(decodeURIComponent(a.data().productNorma_upakovki)),productPartnerCount:null==JSON.parse(decodeURIComponent(a.data().productPartnerCount))?"0":JSON.parse(decodeURIComponent(a.data().productPartnerCount)),productPrices:null==JSON.parse(decodeURIComponent(a.data().productPrices))?{price_not_available:!0}:JSON.parse(decodeURIComponent(a.data().productPrices)),product_id:JSON.parse(decodeURIComponent(a.data().product_id)),storage_id:a.data().productStorageId},d=a.data("product_id"),e=+c[1],f=a.find(".order_block"),g=a.find(".ordered_block"),h=g.find(".ordered_count .bold"),i=g.find(".ordered_price .bold"),j=0;if(!b.productPrices.price_not_available){if(b.productPrices.price_range)if(null!==b.productMarketingPrice){var k=+b.productMarketingPriceCurrency;j=+b.productMarketingPrice*getRateOfExchange(k)}else if(b.productPrices.price_range.length){for(var l,m=0;m<b.productPrices.price_range.length;m++)if(l=m+1==b.productPrices.price_range.length?b.productPrices.price_range.length-1:m+1,parseInt(b.productPrices.price_range[m].range)<=e&&parseInt(b.productPrices.price_range[l].range)>e){j=parseFloat(+b.productPrices.price_range[m].value*getRateOfExchange(b.productPrices.price_range[m].currency)).toFixed(2);break}else j=parseFloat(+b.productPrices.price_range[l].value*getRateOfExchange(b.productPrices.price_range[l].currency)).toFixed(2);}else j=parseFloat(+b.productPrices.price_range.value*getRateOfExchange(b.productPrices.price_range.currency)).toFixed(2);}else if(null!==b.productMarketingPrice){var k=+b.productMarketingPriceCurrency;j=+b.productMarketingPrice*getRateOfExchange(k)}h.html(e+" \u0448\u0442"),0<e*j?i.html((e*j).toFixed(2)+" \u20BD"):i.html("\u043F\u043E \u0437\u0430\u043F\u0440\u043E\u0441\u0443"),b.productPrices.price_not_available&&(null==b.productMarketingPrice||0==b.productMarketingPrice)&&0==i.find(".count_tooltip").length&&(i.addClass("tooltip_sum"),i.append("<span class=\"count_tooltip\">\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u0431\u0443\u0434\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0430 \u043F\u043E\u0441\u043B\u0435 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438 \u0437\u0430\u043F\u0440\u043E\u0441\u0430.<span class=\"corner\"></span></span>")),f.hide().addClass("hidden"),g.show().removeClass("hidden")}});"/cart/"==document.location.pathname&&0==b.length&&$(".product_cards_block._order").html("<h1>\u0424\u043E\u0440\u043C\u0430 \u0437\u0430\u043F\u0440\u043E\u0441\u0430</h1> <div class=\"_order_section _selected_products\"> <h2>\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u043D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u044F</h2> <div class=\"empty_order\">\u0412\u044B \u0435\u0449\u0435 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u043B\u0438 \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u044F \u0432 \u0437\u0430\u043F\u0440\u043E\u0441</div> </div>")}function cartPositionDelete(a,b,c){for(var d=cookie.getCookie("cart")?cookie.getCookie("cart"):"",e=d.length?d.split("&"):[],f=0;f<e.length;f++)-1!==e[f].indexOf(a+"|")&&-1!==e[f].indexOf("|"+c)&&(console.log(e[f]),e.splice(f,1));$(".contact_item.order .order_count").text(e.length);var g=new Date;g.setHours(0,0,0,0),g.setDate(g.getDate()+1),console.log(g),cookie.setCookie("cart",e.join("&"),{path:"/",expires:g})}function orderLinkCountUpdate(){var a=cookie.getCookie("cart")?cookie.getCookie("cart"):"",b=a.length?a.split("&"):[];$(".contact_item.order .order_count").text(b.length)}function cartUpdate(a,b,c){for(var d=cookie.getCookie("cart")?cookie.getCookie("cart"):"",e=d.length?d.split("&"):[],f=0;f<e.length;f++)-1!==e[f].indexOf("|"+$(a)+"|")&&-1!==e[f].indexOf("|"+c+"|")&&(e[f]=a+"|"+b+"|"+c);d=e.join("&"),-1==d.indexOf(a+"|"+b+"|"+c)&&e.push(a+"|"+b+"|"+c),console.log(e),$(".contact_item.order .order_count").text(e.length);var g=new Date;g.setHours(0,0,0,0),g.setDate(g.getDate()+1),console.log(g),cookie.setCookie("cart",e.join("&"),{path:"/",expires:g})}function join(a){var b=1<arguments.length?arguments[1]:", ";return a.filter(function(a){return a}).join(b)}function typeDescription(a){return{INDIVIDUAL:"\u0418\u043D\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0440\u0435\u0434\u043F\u0440\u0438\u043D\u0438\u043C\u0430\u0442\u0435\u043B\u044C",LEGAL:"\u041E\u0440\u0433\u0430\u043D\u0438\u0437\u0430\u0446\u0438\u044F"}[a]}function showSuggestion(a){console.log(a),$(".selected_org").html("<p>"+a.data.name.full_with_opf+"</p><p>\u0410\u0434\u0440\u0435\u0441: "+a.data.address.value+"</p><p>\u0418\u041D\u041D: "+a.data.inn+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u041A\u041F\u041F: "+a.data.kpp+"</p>");var b=a.data.address.data?a.data.address.data.city?a.data.address.data.city:null:null;$("input[name=\"Order[client_kpp]\"]").val(a.data.kpp),$("input[name=\"Order[client_inn]\"]").val(a.data.inn),$("input[name=\"Order[client_fullname]\"]").val(a.data.name.full_with_opf),$("input[name=\"Order[client_shortname]\"]").val(a.data.name.short_with_opf),$("input[name=\"Order[client_address]\"]").val(a.data.address.value),$("input[name=\"Order[client_city]\"]").val(b);var c=a.data;c&&($("#type").text(typeDescription(c.type)+" ("+c.type+")"),c.name&&$("#name_short").val(join([c.opf&&c.opf.short||"",c.name.short||c.name.full]," ")),c.name&&c.name.full&&$("#name_full").val(join([c.opf&&c.opf.full||"",c.name.full]," ")),$("#inn_kpp").val(join([c.inn,c.kpp]," / ")),c.address&&$("#address").val(c.address.value))}function getCityList(){$.getJSON("/admin/pek/get-towns",function(a){var b={},c=$(".js-city-select");for(var d in a)for(var e in a[d])0>e&&(b[e]=d,c.append("<option value=\""+e+"\">"+b[e]+"</option>"));return b})}function getDeliveryTime(a){var b=document.getElementById("delivery_var3").checked,c=" + 1-2 \u0440\u0430\u0431.\u0434\u043D. \u0434\u043E \u0434\u0432\u0435\u0440\u0438.";$.getJSON("http://rusel24.fvds.ru/admin/pek/get-delivery/?delivery="+a,function(a){b||(c=""),a.periods_days?($(".delivery_time_text").text("\u0421\u0440\u043E\u043A \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438 "+a.auto[1]+" \u043E\u0440\u0438\u0435\u043D\u0442\u0438\u0440\u043E\u0432\u043E\u0447\u043D\u043E : "+a.periods_days+" \u0440\u0430\u0431.\u0434\u043D."+c),$(".js-delivery_time").val("\u0421\u0440\u043E\u043A \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438 "+a.auto[1]+" \u043E\u0440\u0438\u0435\u043D\u0442\u0438\u0440\u043E\u0432\u043E\u0447\u043D\u043E : "+a.periods_days+" \u0440\u0430\u0431.\u0434\u043D."+c)):($(".delivery_time_text").text(""),$(".js-delivery_time").val(""))})}var cookie={getCookie:function(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):void 0},setCookie:function(a,b,c){c=c||{};var e=c.expires;if("number"==typeof e&&e){var f=new Date;f.setTime(f.getTime()+1e3*e),e=c.expires=f}e&&e.toUTCString&&(c.expires=e.toUTCString()),b=encodeURIComponent(b);var d=a+"="+b;for(var g in c){d+="; "+g;var h=c[g];!0!==h&&(d+="="+h)}document.cookie=d},deleteCookie:function(a){this.setCookie(a,"",{expires:-1}),console.log(document.cookie)}};